@{
    ViewBag.Title = "Home Page";
}

<!DOCTYPE html>
<html lang="en" class="h-100">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PPT Tech Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>

<body class="d-flex h-100 text-center text-bg-dark">

    <div class="d-flex w-100 h-100 p-3 mx-auto flex-column">
        <header class="mb-auto">
            <div>
                <h3 class="float-md-start mb-0">Pacific Programming and Tech</h3>
            </div>
        </header>

        <main class="px-3">
            <h1>Technical Test.</h1>
            <p>Change the user identifier to get their profile image</p>
            <div class="d-flex justify-content-center pb-3">
                <input type="text" class="form-control w-auto mx-2" id="userIdentifierInput" placeholder="User identifier">
                <button type="submit" class="btn btn-sm fw-bold border-white bg-white text-black mx-2" onclick="onButtonClick()">Get profile image</button>
            </div>
            <div>
                <img src="https://api.dicebear.com/8.x/pixel-art/png?size=150" id="userAvatarImage" class="rounded border border-4 border-secondary" />
            </div>
        </main>

        <footer class="mt-auto text-white-50">
            <p>Send completed submissions to backend-tech-test@dblexchange.com</p>
        </footer>
    </div>
</body>
</html>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jqueryui")

<script type="text/javascript">
        function onButtonClick() {
            // 📃 To do: Get avatar URI from back end
            var userId = $("#userIdentifierInput").val();
            getImg(userId);

            // const userIdentifier = document.getElementById('userIdentifierInput').value;
            // const response = await fetch(`https://localhost:7126/avatar?userIdentifier=${userIdentifier}`);
            // const responseBody = await response.json();
            // const avatarUrl = responseBody.url;

            // const avatarUrl = 'https://api.dicebear.com/8.x/pixel-art/png?seed=default&size=150';
            // document.getElementById('userAvatarImage').src = avatarUrl;
    }

    function getImg(userId) {
        $.ajax({
    url: '@Url.Action("GetImageUrl", "Home")',  // URL de la acción del controlador
            type: 'GET',
            data: { userIdentifier: userId },
            contentType: "application/json; charset=utf-8",
    success: function (data) {
        // Actualizar el atributo 'src' de la imagen con la URL recibida
        $("#userAvatarImage").attr("src", data);
    },
    error: function () {
        alert("Error al traer la URL de la imagen.");
    }
});
    }

</script>
}